<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Agent Local - Cockpit</title>
    <link rel="stylesheet" href="/style.css">
    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div class="dashboard-container">
    
    <!-- 1. TIMELINE (Haut) -->
    <header class="dashboard-header">
        <!-- Top Bar: Brand + Status + Controls -->
        <div class="header-top-bar">
            <div class="header-brand">
                <span class="brand-icon">ü§ñ</span>
                <div class="brand-info">
                    <h1>AGENT LOCAL</h1>
                    <small id="session-id">Session: ...</small>
                </div>
            </div>
            
            <div class="header-controls">
                <div id="timer-display" class="timer-display">00:00:00</div>
                <button class="btn-stop-emergency" onclick="stopAgent()" title="ARR√äT D'URGENCE">
                    <i class="fas fa-power-off"></i> STOP
                </button>
            </div>
        </div>
        
        <!-- Real-time Agent Status (New Design) -->
        <div class="agent-monitor-container">
            <!-- Active Agent Card (Will be duplicated if multiple agents active) -->
            <div id="active-agent-card" class="agent-monitor-card">
                <div class="agent-card-header">
                    <div class="agent-identity">
                        <div class="agent-avatar-large">ü§ñ</div>
                        <div class="agent-details">
                            <h2 id="monitor-agent-name">Orchestrator</h2>
                            <span id="monitor-agent-role">System Controller</span>
                        </div>
                    </div>
                    <div class="agent-status-badge" id="monitor-status-badge">
                        <span class="status-indicator-dot"></span>
                        <span id="monitor-status-text">INITIALIZING</span>
                    </div>
                </div>
                
                <div class="agent-card-body">
                    <div class="agent-main-action">
                        <span class="action-label">ACTION EN COURS</span>
                        <div class="action-text" id="monitor-action-text">D√©marrage du syst√®me...</div>
                    </div>
                    
                    <div class="agent-location-info">
                        <i class="fas fa-map-marker-alt"></i>
                        <span id="monitor-location-text">Syst√®me</span>
                    </div>
                </div>
                
                <div class="agent-card-footer">
                    <div class="agent-timer">
                        <i class="fas fa-stopwatch"></i>
                        <span id="monitor-duration">00:00</span>
                    </div>
                    <div class="agent-progress-bar">
                        <div class="progress-fill" id="monitor-progress"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 2. MAIN GRID (Reste de l'√©cran) -->
    <div class="dashboard-grid">
        
        <!-- COLONNE GAUCHE : RESSOURCES & RAG -->
        <aside class="panel panel-left">
            <div class="panel-header">
                <h2><i class="fas fa-database"></i> Ressources & RAG</h2>
            </div>
            
            <div class="panel-content">
                <!-- Zone Upload RAG -->
                <div class="rag-upload-controls">
                    <select id="rag-dataset-select" class="rag-select" title="Choisir le dataset cible">
                        <option value="default">Dataset: default</option>
                        <option value="new">+ Nouveau dataset...</option>
                    </select>
                    <input type="text" id="rag-new-dataset-input" class="rag-input hidden" placeholder="Nom du dataset..." />
                </div>
                <div class="drop-zone" id="rag-drop-zone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Glisser documents pour <strong>RAG</strong></p>
                    <small>ou cliquer pour parcourir</small>
                </div>

                <!-- Structure RAG / Dossiers -->
                <div class="resource-list">
                    <h3><i class="fas fa-folder-open"></i> Explorateur</h3>
                    <ul id="file-explorer" class="file-tree">
                        <li><i class="fas fa-folder"></i> memory/</li>
                        <li><i class="fas fa-folder"></i> backend/</li>
                        <li><i class="fas fa-file-word"></i> rapport_mission.docx</li>
                    </ul>
                </div>

                <!-- Artefacts (Fichiers g√©n√©r√©s) - D√âPLAC√â ICI -->
                <div class="artifacts-card">
                    <h3><i class="fas fa-magic"></i> Fichiers G√©n√©r√©s</h3>
                    <div id="artifacts-list" class="artifacts-list">
                        <div class="empty-state">Aucun fichier g√©n√©r√© r√©cemment</div>
                    </div>
                </div>

                <!-- √âtat M√©moire -->
                <div class="memory-stats">
                    <div class="stat-item">
                        <span class="label">Dataset:</span>
                        <span class="value" id="current-dataset">D√©faut</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Vecteurs:</span>
                        <span class="value">1,240</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- COLONNE CENTRE : COMMUNICATION -->
        <main class="panel panel-center">
            <div class="chat-container">
                <div id="chat-window" class="chat-history">
                    <!-- Messages -->
                </div>
                
                <!-- Zone Upload Context -->
                <div id="context-drop-overlay" class="context-drop-overlay hidden">
                    <i class="fas fa-plus-circle"></i>
                    <p>Ajouter au contexte de la conversation</p>
                </div>

                <div class="chat-input-area">
                    <button id="mic-button" class="btn-icon" onclick="toggleMicrophone()" title="F1: Micro">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button id="attach-button" class="btn-icon" onclick="attachFileToContext()" title="Ajouter un fichier au contexte">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="file" id="context-file-input" style="display: none;" accept=".txt,.md,.pdf,.docx,.py,.js,.html,.css,.json" multiple />
                    <textarea
                        id="user-message"
                        placeholder="Instructions pour l'agent..."
                        rows="1"
                    ></textarea>
                    <button id="validate-todo-btn" class="btn-validate-todo" onclick="validateTodoSequence()" title="Valider la s√©quence TODO">
                        <i class="fas fa-check-circle"></i>
                    </button>
                    <button class="btn-send" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </main>

        <!-- COLONNE DROITE : MISSION CONTROL -->
        <aside class="panel panel-right">
            
            <!-- Agents & Routing -->
            <div class="agents-card">
                <h3><i class="fas fa-users-cog"></i> Agents & Routing</h3>
                
                <!-- Auto-routing Toggle -->
                <div class="routing-control">
                    <label class="switch-label">
                        <span class="label-text">Auto-routing</span>
                        <label class="switch">
                            <input type="checkbox" id="auto-routing-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </label>
                </div>

                <!-- Agent List -->
                <div id="agents-list" class="agents-list">
                    <div class="loading-agents">Chargement des agents...</div>
                    <!-- Agents will be injected here -->
                </div>
            </div>

            <!-- √âtat Actuel -->
            <div class="status-card">
                <h3><i class="fas fa-heartbeat"></i> Statut Agent</h3>
                <div class="status-indicator" id="agent-status-text">
                    <span class="status-dot"></span> En attente
                </div>
                <div class="current-action-detail" id="current-action-detail">
                    Aucune t√¢che en cours
                </div>
            </div>

            <!-- Outils Externes -->
            <div class="tools-card">
                <h3><i class="fas fa-tools"></i> Outils</h3>
                <div class="tool-item">
                    <i class="fas fa-globe"></i> Web Search
                    <span class="tool-status inactive">Inactif</span>
                </div>
                <div class="tool-item">
                    <i class="fas fa-file-word"></i> MS Word
                    <span class="tool-status inactive">Inactif</span>
                </div>
                <div class="tool-item">
                    <i class="fas fa-mouse-pointer"></i> Contr√¥le PC
                    <span class="tool-status active">Pr√™t</span>
                </div>
            </div>

            <!-- TODO List / S√©quences d'Actions -->
            <div class="todo-card">
                <h3><i class="fas fa-tasks"></i> S√©quences d'Actions</h3>
                <div id="todo-list" class="todo-list">
                    <div class="empty-state">Aucune s√©quence en cours</div>
                    <!-- Les TODO seront ajout√©s dynamiquement ici -->
                </div>
            </div>

        </aside>
    </div>
</div>

<!-- FLOATING INTERFACE (F2) - Conserv√©e mais masqu√©e par d√©faut -->
<div id="floating-interface" class="floating-interface hidden">
    <div class="floating-header" id="floating-header">
        <span class="floating-title">ü§ñ Agent Local</span>
        <div class="floating-controls">
            <button class="btn-floating-stop" onclick="stopAgent()">üõë</button>
            <button class="btn-floating-close" onclick="toggleFloatingInterface()">‚úñ</button>
        </div>
    </div>
    <div id="floating-chat-window" class="floating-chat-history"></div>
    <div class="floating-input-container">
        <input id="floating-user-message" type="text" placeholder="Message..." autocomplete="off"/>
        <button class="btn-floating-send" onclick="sendFloatingMessage()">‚û§</button>
    </div>
</div>

<script src="/app.js"></script>
</body>
</html>
